version: 2.1

orbs:
  path-filtering: circleci/path-filtering@0.0.2

setup: true

workflows:
  trigger-services:
    jobs:
    - path-filtering/filter:
        name: detect-auth-changes
        base-revision: main
        config-path: .circleci/auth-config.yml
        mapping: |
          auth/.* auth_build_and_deploy true
          payment/.* payment_build_and_deploy false
          search/.* search_build_and_deploy false

    - path-filtering/filter:
        name: detect-payment-changes
        base-revision: main
        config-path: .circleci/payment-config.yml
        mapping: |
          payment/.* payment_build_and_deploy true
          auth/.* auth_build_and_deploy false
          search/.* search_build_and_deploy false

    - path-filtering/filter:
        name: detect-search-changes
        base-revision: main
        config-path: .circleci/search-config.yml
        mapping: |
          search/.* search_build_and_deploy true
          payment/.* payment_build_and_deploy false
          auth/.* auth_build_and_deploy false
